<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Quản lý tài khoản Face ID</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen p-4 md:p-8">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="flex items-center justify-between mb-8">
            <div>
                <h1 class="text-2xl font-bold bg-gradient-to-r from-amber-400 to-orange-500 bg-clip-text text-transparent">
                    Quản lý tài khoản Face ID
                </h1>
                <p class="text-gray-400 text-sm mt-1">Danh sách người dùng đã đăng ký</p>
            </div>
            <a 
                href="/" 
                class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg font-medium transition-colors"
            >
                ← Về trang chủ
            </a>
        </div>

        <!-- Accounts Table -->
        <div class="bg-gray-800 rounded-xl overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="bg-gray-700/50 border-b border-gray-600">
                            <th class="text-left px-4 py-3 font-semibold">#</th>
                            <th class="text-left px-4 py-3 font-semibold">Họ tên</th>
                            <th class="text-left px-4 py-3 font-semibold">Email</th>
                            <th class="text-left px-4 py-3 font-semibold">Số điện thoại</th>
                            <th class="text-right px-4 py-3 font-semibold">Thao tác</th>
                        </tr>
                    </thead>
                    <tbody id="accountsTable">
                        <tr>
                            <td colspan="5" class="text-center py-8 text-gray-400">
                                <span class="animate-spin">⏳</span> Đang tải...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="emptyState" class="hidden text-center py-12 text-gray-400">
            Chưa có tài khoản nào đăng ký.
        </div>
    </div>

    <script>
        const API_BASE = `http://${window.location.hostname}:5001`;

        async function loadAccounts() {
            try {
                const res = await fetch(`${API_BASE}/api/admin/accounts`);
                const data = await res.json();
                renderAccounts(data.accounts || []);
            } catch (err) {
                document.getElementById('accountsTable').innerHTML = `
                    <tr><td colspan="5" class="text-center py-8 text-red-400">
                        Lỗi tải dữ liệu: ${err.message}
                    </td></tr>`;
            }
        }

        function renderAccounts(accounts) {
            const tbody = document.getElementById('accountsTable');
            const emptyState = document.getElementById('emptyState');

            if (accounts.length === 0) {
                tbody.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }
            emptyState.classList.add('hidden');

            tbody.innerHTML = accounts.map((acc, i) => {
                const safeName = escapeHtml(acc.name).replace(/"/g, '&quot;');
                return `
                <tr class="border-b border-gray-700 hover:bg-gray-700/30">
                    <td class="px-4 py-3 text-gray-400">${i + 1}</td>
                    <td class="px-4 py-3 font-medium">${safeName}</td>
                    <td class="px-4 py-3 text-gray-300">${escapeHtml(acc.email || '-')}</td>
                    <td class="px-4 py-3 text-gray-300">${escapeHtml(acc.phone || '-')}</td>
                    <td class="px-4 py-3 text-right">
                        <button 
                            data-name="${safeName}" 
                            class="btn-delete px-3 py-1.5 bg-red-600/80 hover:bg-red-600 rounded text-sm"
                        >
                            Xóa
                        </button>
                    </td>
                </tr>`;
            }).join('');

            tbody.querySelectorAll('.btn-delete').forEach(btn => {
                btn.addEventListener('click', () => {
                    deleteAccount(btn.getAttribute('data-name'));
                });
            });
        }

        function escapeHtml(str) {
            const div = document.createElement('div');
            div.textContent = str || '';
            return div.innerHTML;
        }

        async function deleteAccount(name) {
            if (!confirm(`Bạn có chắc muốn xóa "${name}"?`)) return;
            try {
                const res = await fetch(`${API_BASE}/api/admin/accounts/${encodeURIComponent(name)}`, {
                    method: 'DELETE'
                });
                const data = await res.json();
                if (data.status === 'success') {
                    loadAccounts();
                } else {
                    alert(data.message || 'Xóa thất bại');
                }
            } catch (err) {
                alert('Lỗi: ' + err.message);
            }
        }

        loadAccounts();
    </script>
</body>
</html>
